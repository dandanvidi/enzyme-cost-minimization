<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fsc_enzyme_cost_minimization</title>
  <meta name="keywords" content="fsc_enzyme_cost_minimization">
  <meta name="description" content="FSC_ENZYME_COST_MINIMIZATION - Compute optimal flux-specific enzyme costs for given flux distribution">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">matlab</a> &gt; <a href="#">enzyme-cost-minimization</a> &gt; fsc_enzyme_cost_minimization.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./matlab/enzyme-cost-minimization&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>fsc_enzyme_cost_minimization
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>FSC_ENZYME_COST_MINIMIZATION - Compute optimal flux-specific enzyme costs for given flux distribution</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [c, u, u_cost, up, A_forward, mca_info, c_min, c_max, u_min, u_max] = fsc_enzyme_cost_minimization(network,r,v,fsc_options) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> FSC_ENZYME_COST_MINIMIZATION - Compute optimal flux-specific enzyme costs for given flux distribution

 [c, u, u_cost, up, A_forward, mca_info, c_min, c_max, u_min, u_max] = fsc_enzyme_cost_minimization(network, e, v, fsc_options)

 Input 
   network       metabolic network structure (as in Metabolic Network Toolbox)
   r             Kinetic constants (from parameter balancing)
   v             flux mode
   fsc_options   options struct (for fields and default values, see 'fsc_default_options')

 Output
   c                 metabolite concentrations
   c.data            data vector (if provided)
   c.fixed           fixed concentration vector
   c.initial         initial solution vector 
   c.[SCORE]         1st column: result from optimising the score [SCORE]
                     other columns: possible sampled solutions
                     
   u                 enzyme levels (all enzymes)
   u.data            data vector
   u.[SCORE]         1st column: result from optimising the score [SCORE]
                     other columns: possible sampled solutions

   up                enzyme levels (only scored enzymes as defined by 
                                    fsc_scores.ind_scored_enzymes)
   up.[SCORE]        1st column: result from optimising the score [SCORE]
                     other columns: possible sampled solutions

   u_cost            sum of scored enzyme levels 
   u_cost.data       data value
   u_cost.[SCORE]    1st column: result from optimising the score [SCORE]
                     other columns: possible sampled solutions

   A_forward         reaction affinity (in flux direction)
   A_forward.initial    initial solution vector 
   A_forward.[SCORE] 1st column: result from optimising the score [SCORE]
                     other columns: possible sampled solutions</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="../.././matlab/enzyme-cost-minimization/ecf_scores/ecm_mdf.html" class="code" title="function [f,u,w] = ecm_mdf(x,pp)">ecm_mdf</a>	[f,u] = ecm_mdf(x,pp)</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_below_threshold.html" class="code" title="function [ineq_constraints, eq_constraints] = ecm_below_threshold(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_below_threshold</a>	function needed for enzyme cost minimization</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_one_u.html" class="code" title="function my_u_it = ecm_get_one_u(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_get_one_u</a>	function my_u_it = ecm_get_one_u(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_score.html" class="code" title="function [u_cost, u] = ecm_get_score(fsc_score,x,pp)">ecm_get_score</a>	</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_specific_rates.html" class="code" title="function rates = ecm_get_specific_rates(fsc_score,x,pp,ind)">ecm_get_specific_rates</a>	</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_one_run.html" class="code" title="function [my_c, my_u, my_up, my_u_cost, my_A_forward, my_x, my_grad, my_lambda] = ecm_one_run(fsc_score,pp,x_min,x_max,x_init,fsc_options,opt)">ecm_one_run</a>	% optimize log concentration profile</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_inequalities.html" class="code" title="function [delta_G_by_RT,eq_cons] = measures_for_enzyme_costs_inequalities(x,N_forward,log_Keq_forward)">fsc_inequalities</a>	[delta_G_by_RT,eq_cons] = measures_for_enzyme_costs_inequalities(x,N_forward,log_Keq_forward)</li><li><a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_regularisation.html" class="code" title="function f = fsc_regularisation(x,x_min,x_max,lambda)">fsc_regularisation</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [c, u, u_cost, up, A_forward, mca_info, c_min, c_max, u_min, u_max] = fsc_enzyme_cost_minimization(network,r,v,fsc_options)</a>
0002 
0003 <span class="comment">% FSC_ENZYME_COST_MINIMIZATION - Compute optimal flux-specific enzyme costs for given flux distribution</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% [c, u, u_cost, up, A_forward, mca_info, c_min, c_max, u_min, u_max] = fsc_enzyme_cost_minimization(network, e, v, fsc_options)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% Input</span>
0008 <span class="comment">%   network       metabolic network structure (as in Metabolic Network Toolbox)</span>
0009 <span class="comment">%   r             Kinetic constants (from parameter balancing)</span>
0010 <span class="comment">%   v             flux mode</span>
0011 <span class="comment">%   fsc_options   options struct (for fields and default values, see 'fsc_default_options')</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% Output</span>
0014 <span class="comment">%   c                 metabolite concentrations</span>
0015 <span class="comment">%   c.data            data vector (if provided)</span>
0016 <span class="comment">%   c.fixed           fixed concentration vector</span>
0017 <span class="comment">%   c.initial         initial solution vector</span>
0018 <span class="comment">%   c.[SCORE]         1st column: result from optimising the score [SCORE]</span>
0019 <span class="comment">%                     other columns: possible sampled solutions</span>
0020 <span class="comment">%</span>
0021 <span class="comment">%   u                 enzyme levels (all enzymes)</span>
0022 <span class="comment">%   u.data            data vector</span>
0023 <span class="comment">%   u.[SCORE]         1st column: result from optimising the score [SCORE]</span>
0024 <span class="comment">%                     other columns: possible sampled solutions</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%   up                enzyme levels (only scored enzymes as defined by</span>
0027 <span class="comment">%                                    fsc_scores.ind_scored_enzymes)</span>
0028 <span class="comment">%   up.[SCORE]        1st column: result from optimising the score [SCORE]</span>
0029 <span class="comment">%                     other columns: possible sampled solutions</span>
0030 <span class="comment">%</span>
0031 <span class="comment">%   u_cost            sum of scored enzyme levels</span>
0032 <span class="comment">%   u_cost.data       data value</span>
0033 <span class="comment">%   u_cost.[SCORE]    1st column: result from optimising the score [SCORE]</span>
0034 <span class="comment">%                     other columns: possible sampled solutions</span>
0035 <span class="comment">%</span>
0036 <span class="comment">%   A_forward         reaction affinity (in flux direction)</span>
0037 <span class="comment">%   A_forward.initial    initial solution vector</span>
0038 <span class="comment">%   A_forward.[SCORE] 1st column: result from optimising the score [SCORE]</span>
0039 <span class="comment">%                     other columns: possible sampled solutions</span>
0040 
0041 
0042 <span class="comment">% --------------------------------------------------------------------------------------</span>
0043 <span class="comment">% Enzyme cost minimization</span>
0044 <span class="comment">% --------------------------------------------------------------------------------------</span>
0045 
0046 opt = optimset(<span class="string">'MaxFunEvals'</span>,10^15,<span class="string">'MaxIter'</span>,10^15,<span class="string">'TolX'</span>,10^-10,<span class="string">'Display'</span>,<span class="string">'off'</span>,<span class="string">'Algorithm'</span>,<span class="string">'sqp'</span>);
0047 
0048 network.kinetics = set_kinetics(network,<span class="string">'cs'</span>,r);
0049 
0050 
0051 <span class="comment">% --------------------------------------------------------------------------------------</span>
0052 <span class="comment">% initialise</span>
0053 
0054 [Mplus, Mminus, Wplus, Wminus, nm, nr] = make_structure_matrices(network.N,network.regulation_matrix,find(network.external));
0055 
0056 ind_scored_enzymes = fsc_options.ind_scored_enzymes ;
0057 ind_not_scored     = setdiff(1:nr,ind_scored_enzymes);
0058 
0059 c_data              = fsc_options.c_data             ;
0060 u_data              = fsc_options.u_data             ;  
0061 conc_min_default    = fsc_options.conc_min_default   ;
0062 conc_max_default    = fsc_options.conc_max_default   ;
0063 conc_fix            = fsc_options.conc_fix;
0064 conc_min            = fsc_options.conc_min;
0065 conc_max            = fsc_options.conc_max;
0066 conc_min(isnan(conc_min)) = conc_min_default;
0067 conc_max(isnan(conc_max)) = conc_max_default;
0068 fsc_scores          = fsc_options.fsc_scores         ;
0069 ind_met_fix         = fsc_options.ind_met_fix;
0070 enzyme_cost_weights = fsc_options.enzyme_cost_weights;
0071 
0072 
0073 <span class="comment">% --------------------------------------------------------------------------------------</span>
0074 <span class="comment">% initialise c, u, u_cost; insert true concentrations and protein levels</span>
0075 
0076 c.data      = c_data;
0077 u.data      = u_data;
0078 u_cost.data = nansum(u.data);
0079 
0080 
0081 <span class="comment">% --------------------------------------------------------------------------------------</span>
0082 <span class="comment">% adjust some network- and kinetics-related variables</span>
0083 
0084 x_min = log(conc_min);
0085 x_max = log(conc_max);
0086 x_fix = nan * ones(nm,1);
0087 x_fix(ind_met_fix) = log(conc_fix); <span class="comment">%  ,</span>
0088 ind_fix = find(isfinite(x_fix)); 
0089 
0090 x_min(ind_fix) = x_fix(ind_fix);<span class="comment">% - 10^-4;</span>
0091 x_max(ind_fix) = x_fix(ind_fix);<span class="comment">% + 10^-4;</span>
0092 
0093 ind_pos = find(v&gt;=0);
0094 ind_neg = find(v&lt;0);
0095 
0096 M_forward(ind_pos,:)        = Mplus(ind_pos,:);
0097 M_forward(ind_neg,:)        = Mminus(ind_neg,:);
0098 Mprod_forward(ind_pos,:)    = Mminus(ind_pos,:);
0099 Mprod_forward(ind_neg,:)    = Mplus(ind_neg,:);
0100 N_forward(:,ind_pos)        =  network.N(:,ind_pos);
0101 N_forward(:,ind_neg)        = -network.N(:,ind_neg);
0102 kc_forward(ind_pos,1)       = r.Kcatf(ind_pos);
0103 kc_forward(ind_neg,1)       = r.Kcatr(ind_neg);
0104 log_Keq_forward(ind_pos,1)  = log(r.Keq(ind_pos));
0105 log_Keq_forward(ind_neg,1)  = -log(r.Keq(ind_neg));
0106 KM                          = full(r.KM);
0107 KM(network.N'==0)           = 1;
0108 KMf                         = exp(sum(Mplus.*log(KM),2));
0109 KMr                         = exp(sum(Mminus.*log(KM),2));
0110 km_forward(ind_pos,1)       = KMf(ind_pos);
0111 km_forward(ind_neg,1)       = KMr(ind_neg);
0112 kmprod_forward(ind_pos,1)   = KMr(ind_pos);
0113 kmprod_forward(ind_neg,1)   = KMf(ind_neg);
0114 
0115 
0116 <span class="comment">% --------------------------------------------------------------------------</span>
0117 <span class="comment">% struct with parameters used in cost score functions</span>
0118 
0119 pp.v                   = v                  ; 
0120 pp.network             = network            ;
0121 pp.M_forward           = M_forward          ;
0122 pp.Mprod_forward       = Mprod_forward      ;
0123 pp.N_forward           = N_forward          ;
0124 pp.log_Keq_forward     = log_Keq_forward    ;
0125 pp.kc_forward          = kc_forward         ;
0126 pp.km_forward          = km_forward         ;
0127 pp.kmprod_forward      = kmprod_forward     ;
0128 pp.ind_scored_enzymes  = ind_scored_enzymes ;
0129 pp.enzyme_cost_weights = enzyme_cost_weights;
0130 pp.ind_not_scored      = ind_not_scored     ;
0131 
0132 
0133 <span class="comment">% --------------------------------------------------------------------------------------</span>
0134 <span class="comment">% find feasible initial solution (as a test for feasibility) and extreme metabolite profiles</span>
0135 
0136 <span class="comment">%epsilon = 10^-10;   % flux directions must be possible at least</span>
0137 epsilon = 1 * 1/RT;  <span class="comment">% minimal reaction GFE of 1 kJ/mol is required</span>
0138 
0139 <span class="keyword">try</span>
0140   [x_start, x1, x2] = find_polytope_centre([],[], N_forward', log_Keq_forward - epsilon, x_min, x_max, 0*x_min);
0141 <span class="keyword">catch</span>
0142   error(sprintf(<span class="string">'*** No polytope centre found (where driving forces &gt; %f RT were required) - maybe the concentration constraints are infeasible? ***'</span>,epsilon));
0143   c = [];  u = [];  u_cost = [];  up = [];  A_forward = [];
0144   <span class="keyword">return</span>
0145 <span class="keyword">end</span>
0146 
0147 X_extreme = [x1, x2]; <span class="comment">% matrix with extreme initial concentration vectors</span>
0148 
0149 
0150 <span class="comment">% --------------------------------------------------------------------------</span>
0151 <span class="comment">% choose the starting point</span>
0152 
0153 
0154 <span class="keyword">switch</span> fsc_options.initial_choice,
0155   <span class="keyword">case</span> <span class="string">'polytope_center'</span>,
0156     display(<span class="string">'  Choosing polytope center as starting point'</span>); 
0157   <span class="keyword">case</span> <span class="string">'interval_center'</span>,
0158     display(<span class="string">'  Choosing point close to center of allowed intervals as starting point'</span>); 
0159     x_start = fmincon(@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_regularisation.html" class="code" title="function f = fsc_regularisation(x,x_min,x_max,lambda)">fsc_regularisation</a>(xx,x_min,x_max,1), x_start,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_inequalities.html" class="code" title="function [delta_G_by_RT,eq_cons] = measures_for_enzyme_costs_inequalities(x,N_forward,log_Keq_forward)">fsc_inequalities</a>(xx,N_forward,log_Keq_forward),opt);
0160   <span class="keyword">case</span> <span class="string">'mdf'</span>,
0161     x_start = fmincon(@(xx) <a href="../.././matlab/enzyme-cost-minimization/ecf_scores/ecm_mdf.html" class="code" title="function [f,u,w] = ecm_mdf(x,pp)">ecm_mdf</a>(xx,pp) + <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_regularisation.html" class="code" title="function f = fsc_regularisation(x,x_min,x_max,lambda)">fsc_regularisation</a>(xx,x_min,x_max,fsc_options.lambda_regularisation), x_start,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_inequalities.html" class="code" title="function [delta_G_by_RT,eq_cons] = measures_for_enzyme_costs_inequalities(x,N_forward,log_Keq_forward)">fsc_inequalities</a>(xx,N_forward,log_Keq_forward),opt);
0162     display(<span class="string">'  Choosing MDF solution as starting point'</span>); 
0163 <span class="keyword">end</span>
0164 
0165 
0166 <span class="comment">% --------------------------------------------------------------------------------------</span>
0167 <span class="comment">% run optimisations starting from x_start</span>
0168 
0169 x_init = x_start;
0170 
0171 c_init         = exp(x_init);
0172 A_forward_init = RT * [log_Keq_forward  - N_forward' * log(c_init)]; 
0173 A_forward_init(ind_not_scored) = nan;
0174 c.fixed          = exp(x_fix);
0175 c.initial         = c_init;
0176 A_forward.initial = A_forward_init;
0177 
0178 display(<span class="string">'  Running optimisation using normal starting point'</span>);
0179 
0180 <span class="keyword">for</span> it_method = 1:length(fsc_scores),
0181 
0182   fsc_score = fsc_scores{it_method};
0183   display(sprintf(<span class="string">'   %s'</span>,fsc_score));
0184   
0185   [my_c, my_u, my_up, my_u_cost, my_A_forward, my_x, my_grad, my_lambda] = <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_one_run.html" class="code" title="function [my_c, my_u, my_up, my_u_cost, my_A_forward, my_x, my_grad, my_lambda] = ecm_one_run(fsc_score,pp,x_min,x_max,x_init,fsc_options,opt)">ecm_one_run</a>(fsc_score,pp,x_min,x_max,x_init,fsc_options,opt);
0186 
0187   c.(fsc_score)         = my_c;
0188   u.(fsc_score)         = my_u;
0189   up.(fsc_score)        = my_up;
0190   u_cost.(fsc_score)    = my_u_cost;
0191   A_forward.(fsc_score) = my_A_forward;
0192   mca_info.(fsc_score).x_gradient = my_grad;
0193   
0194   <span class="keyword">if</span> fsc_options.compute_hessian, 
0195     my_fct = @(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_score.html" class="code" title="function [u_cost, u] = ecm_get_score(fsc_score,x,pp)">ecm_get_score</a>(fsc_score,xx,pp) + <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/fsc_regularisation.html" class="code" title="function f = fsc_regularisation(x,x_min,x_max,lambda)">fsc_regularisation</a>(xx,x_min,x_max,fsc_options.lambda_regularisation);
0196     my_x = log(c.(fsc_score));
0197     mca_info.(fsc_score).x_hessian = hessian(my_fct,my_x);
0198     mca_info.(fsc_score).rates     = <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_specific_rates.html" class="code" title="function rates = ecm_get_specific_rates(fsc_score,x,pp,ind)">ecm_get_specific_rates</a>(fsc_score,my_x,pp);
0199   <span class="keyword">end</span>
0200 
0201   <span class="keyword">if</span> fsc_options.compute_elasticities,
0202     <span class="comment">%% elasticities between the specific rate (i.e. v/u) and x</span>
0203     <span class="keyword">for</span> it_r = 1:nr,
0204       mca_info.(fsc_score).elasticities_rate_x(it_r,:) = gradest(@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_specific_rates.html" class="code" title="function rates = ecm_get_specific_rates(fsc_score,x,pp,ind)">ecm_get_specific_rates</a>(fsc_score,xx,pp,it_r),my_x)';
0205     <span class="keyword">end</span>
0206   <span class="keyword">end</span>
0207   
0208 <span class="keyword">end</span>
0209 
0210 
0211 <span class="comment">% --------------------------------------------------------------------------------------</span>
0212 <span class="comment">% run more optimisations starting from extreme points, or with relaxed optimality condition</span>
0213 
0214 c_min = [];
0215 c_max = [];
0216 u_min = [];
0217 u_max = [];
0218 
0219 
0220 <span class="keyword">for</span> it_method = 1:length(fsc_scores),
0221 
0222   fsc_score = fsc_scores{it_method};
0223   display(sprintf(<span class="string">'   %s'</span>,fsc_score));
0224 
0225   <span class="comment">%% -------------------------------------------------------------------------</span>
0226   <span class="comment">%% run more optimisations starting from extreme points</span>
0227 
0228   <span class="keyword">if</span> fsc_options.multiple_starting_points,
0229   
0230     display(sprintf(<span class="string">'     Running optimisation from %d extreme starting points'</span>,size(X_extreme,2)));
0231     
0232     <span class="keyword">for</span> itt = 1:size(X_extreme,2),
0233 
0234       <span class="comment">%% start from points near the extreme points</span>
0235       x_init = 0.1 * x_start + 0.9 * X_extreme(:,itt); 
0236       fprintf(<span class="string">'%d '</span>,itt)
0237 
0238       <span class="comment">%% same as above</span>
0239       c_init                  = exp(x_init);
0240       A_forward_init          = RT * [log_Keq_forward  - N_forward' * log(c_init)]; 
0241       A_forward_init(ind_not_scored) = nan;
0242       c.fixed                   = exp(x_fix);
0243       c.initial(:,1+itt)         = c_init;
0244       A_forward.initial(:,1+itt) = A_forward_init;
0245       [my_c, my_u, my_up, my_u_cost, my_A_forward] = <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_one_run.html" class="code" title="function [my_c, my_u, my_up, my_u_cost, my_A_forward, my_x, my_grad, my_lambda] = ecm_one_run(fsc_score,pp,x_min,x_max,x_init,fsc_options,opt)">ecm_one_run</a>(fsc_score,pp,x_min,x_max,x_init,fsc_options,opt);
0246       c.(fsc_score)(:,1+itt)         = my_c;
0247       u.(fsc_score)(:,1+itt)         = my_u;
0248       up.(fsc_score)(:,1+itt)        = my_up;
0249       u_cost.(fsc_score)(:,1+itt)    = my_u_cost;
0250       A_forward.(fsc_score)(:,1+itt) = my_A_forward;
0251       
0252     <span class="keyword">end</span>
0253     
0254     <span class="comment">%% copy the best result to the first position</span>
0255     [dum,ind_opt] = min(u_cost.(fsc_score));
0256     
0257     c.initial             = [ c.initial(:,ind_opt)                c.initial               ];  
0258     c.(fsc_score)         = [ c.(fsc_score)(:,ind_opt)         c.(fsc_score)        ];  
0259     u.(fsc_score)         = [ u.(fsc_score)(:,ind_opt)         u.(fsc_score)        ];  
0260     up.(fsc_score)        = [ up.(fsc_score)(:,ind_opt)        up.(fsc_score)       ];  
0261     u_cost.(fsc_score)    = [ u_cost.(fsc_score)(ind_opt)      u_cost.(fsc_score)   ];  
0262     A_forward.(fsc_score) = [ A_forward.(fsc_score)(:,ind_opt) A_forward.(fsc_score)];
0263     A_forward.initial     = [ A_forward.initial(:,ind_opt) A_forward.initial];
0264 
0265   <span class="keyword">end</span>
0266 
0267   <span class="comment">%% -------------------------------------------------------------------------</span>
0268   <span class="comment">%% compute tolerance in log concentration profile</span>
0269   <span class="comment">%% (at some maximum allowed percentage increase in cost)</span>
0270 
0271   <span class="keyword">if</span> fsc_options.compute_tolerance,
0272 
0273     display(<span class="string">'    Computing the effects of relaxed optimality assumptions'</span>);
0274   
0275     x           = log(c.(fsc_score)(:,1));
0276     u_threshold = fsc_options.cost_tolerance_factor * u_cost.(fsc_score)(1);
0277   
0278     my_x_min = x;
0279     my_x_max = x;
0280   
0281     <span class="keyword">for</span> it = 1:length(x),
0282       <span class="keyword">if</span> x(it) ~= x_min(it),
0283         [my_x, my_x_min(it)] = fmincon(@(xx) xx(it), x,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_below_threshold.html" class="code" title="function [ineq_constraints, eq_constraints] = ecm_below_threshold(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_below_threshold</a>(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), opt);
0284       <span class="keyword">end</span>
0285       <span class="keyword">if</span> x(it) ~= x_max(it),
0286         [my_x, my_x_max(it)] = fmincon(@(xx) -xx(it), x,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_below_threshold.html" class="code" title="function [ineq_constraints, eq_constraints] = ecm_below_threshold(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_below_threshold</a>(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), opt);
0287         my_x_max(it) = -my_x_max(it);
0288       <span class="keyword">end</span>
0289     <span class="keyword">end</span>
0290   
0291     c_min.(fsc_score) = exp(my_x_min);
0292     c_max.(fsc_score) = exp(my_x_max);
0293   
0294     <span class="comment">%% compute possible variation in enzyme profile u</span>
0295     <span class="comment">%% (at some maximum allowed percentage increase in cost)</span>
0296     
0297     my_u     = u.(fsc_score)(:,1);
0298     my_u_min = my_u;
0299     my_u_max = my_u;
0300 
0301     <span class="keyword">if</span> sum(isfinite(my_u)),
0302       
0303     <span class="keyword">for</span> it = 1:length(u.data),
0304       [my_x, my_u_min(it),exitflag] = fmincon(@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_one_u.html" class="code" title="function my_u_it = ecm_get_one_u(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_get_one_u</a>(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), x,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_below_threshold.html" class="code" title="function [ineq_constraints, eq_constraints] = ecm_below_threshold(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_below_threshold</a>(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), opt);
0305   
0306       [my_x, my_u_max(it),exitflag] = fmincon(@(xx) -<a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_get_one_u.html" class="code" title="function my_u_it = ecm_get_one_u(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_get_one_u</a>(it,fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), x,[],[],[],[],x_min,x_max,@(xx) <a href="../.././matlab/enzyme-cost-minimization/fsc_functions/ecm_below_threshold.html" class="code" title="function [ineq_constraints, eq_constraints] = ecm_below_threshold(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options)">ecm_below_threshold</a>(fsc_score,xx,pp,u_threshold,x_min,x_max,fsc_options), opt);
0307   
0308       <span class="keyword">if</span> ~exitflag, warning(sprintf(<span class="string">'Enzyme variability in %s: No valid solution found'</span>,network.actions{it})); 
0309         my_u_max(it) = nan;
0310       <span class="keyword">end</span> 
0311   
0312       my_u_max(it) = - my_u_max(it);
0313     <span class="keyword">end</span>
0314   
0315     u_min.(fsc_score) = my_u_min;
0316     u_max.(fsc_score) = my_u_max;
0317 
0318     <span class="keyword">end</span>
0319   <span class="keyword">end</span>
0320   
0321 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 07-Nov-2014 11:29:38 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>