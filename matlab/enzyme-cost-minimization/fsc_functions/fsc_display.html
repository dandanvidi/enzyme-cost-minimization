<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of fsc_display</title>
  <meta name="keywords" content="fsc_display">
  <meta name="description" content="PATHWAY_SPECIFIC_COST_DISPLAY - Display results of Pathway Specific Cost Modelling">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="#">matlab</a> &gt; <a href="#">enzyme-cost-minimization</a> &gt; <a href="#">fsc_functions</a> &gt; fsc_display.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for ./matlab/enzyme-cost-minimization/fsc_functions&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>fsc_display
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>PATHWAY_SPECIFIC_COST_DISPLAY - Display results of Pathway Specific Cost Modelling</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function fsc_display(model_name,network,v,options,fsc_options,c,u,u_tot,up,A_forward,r,kinetic_data,c_min,c_max,u_min,u_max) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> PATHWAY_SPECIFIC_COST_DISPLAY - Display results of Pathway Specific Cost Modelling

 fsc_display(network,v,fsc_options,c,u,u_tot,up,A_forward,r)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fsc_display(model_name,network,v,options,fsc_options,c,u,u_tot,up,A_forward,r,kinetic_data,c_min,c_max,u_min,u_max)</a>
0002 
0003 <span class="comment">% PATHWAY_SPECIFIC_COST_DISPLAY - Display results of Pathway Specific Cost Modelling</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% fsc_display(network,v,fsc_options,c,u,u_tot,up,A_forward,r)</span>
0006 
0007 fsc_options.reaction_order   = load_any_table(fsc_options.reaction_order_file);
0008 fsc_options.metabolite_order = load_any_table(fsc_options.metabolite_order_file);
0009 
0010 <span class="comment">% -----------------------------------</span>
0011 <span class="comment">% info</span>
0012 
0013 display(<span class="string">'Fixed concentrations'</span>)
0014 pm(fsc_options.conc_fix,fsc_options.met_fix)
0015 
0016 <span class="comment">% -----------------------------------</span>
0017 
0018 [nm,nr] = size(network.N);
0019 
0020 value_colors  = flipud(colormapRGBmatrices); <span class="comment">% rb_colors;</span>
0021 enzyme_colors = sunrise_colors(length(fsc_options.ind_scored_enzymes));
0022 
0023 <span class="comment">%cm            = jet(length(fsc_options.fsc_scores));</span>
0024 ca
0025 
0026 <span class="keyword">if</span> ~isfield(fsc_options,<span class="string">'psfile_dir'</span>),
0027   fsc_options.print_graphics = 0;
0028   <span class="keyword">else</span>
0029     <span class="keyword">if</span> isempty(fsc_options.psfile_dir),
0030       fsc_options.print_graphics = 0;
0031     <span class="keyword">end</span>
0032 <span class="keyword">end</span>
0033 
0034 <span class="comment">% -----------------------------------</span>
0035 
0036 reaction_names = network.actions;
0037 
0038 <span class="keyword">if</span> isfield(network,<span class="string">'genes'</span>),
0039   gene_names     = network.genes;
0040 <span class="keyword">else</span>
0041   gene_names     = network.actions;
0042 <span class="keyword">end</span>
0043   
0044 <span class="keyword">if</span> ~isfield(fsc_options,<span class="string">'reaction_order'</span>),
0045   fsc_options.reaction_order = reaction_names;
0046 <span class="keyword">else</span>,
0047   ll = label_names(fsc_options.reaction_order,reaction_names);
0048   fsc_options.reaction_order = fsc_options.reaction_order(find(ll));
0049   fsc_options.reaction_order = [column(fsc_options.reaction_order); column(setdiff(reaction_names,fsc_options.reaction_order))];
0050 <span class="keyword">end</span>
0051 
0052 ind_genes        = label_names(reaction_names,fsc_options.reaction_order);
0053 ind_genes_rev    = label_names(fsc_options.reaction_order,reaction_names);
0054 ind_genes_scored = fsc_options.ind_scored_enzymes(ind_genes_rev);
0055 
0056 
0057 <span class="comment">% -----------------------------------</span>
0058 
0059 <span class="keyword">if</span> ~isfield(fsc_options,<span class="string">'metabolite_order'</span>),
0060   fsc_options.metabolite_order = network.metabolites;
0061 <span class="keyword">else</span>,
0062   fsc_options.metabolite_order = [column(fsc_options.metabolite_order); column(setdiff(network.metabolites,fsc_options.metabolite_order))];
0063 <span class="keyword">end</span>
0064 
0065 ind_show_met = [];
0066 <span class="keyword">for</span> it = 1:length(fsc_options.metabolite_order),
0067   my_metabolite = intersect(fsc_options.metabolite_order{it},fsc_options.show_metabolites);
0068   <span class="keyword">if</span> length(my_metabolite),
0069     ind_show_met = [ ind_show_met, label_names(my_metabolite, network.metabolites)];
0070   <span class="keyword">end</span>
0071 <span class="keyword">end</span>
0072 ind_show_met = ind_show_met(find(ind_show_met));
0073 
0074 <span class="comment">% -----------------------------------</span>
0075 <span class="comment">% GENERAL PLOTS</span>
0076 <span class="comment">% -----------------------------------</span>
0077 
0078 gp = struct(<span class="string">'arrowsize'</span>,0.05,<span class="string">'arrowstyle'</span>,<span class="string">'fluxes'</span>,<span class="string">'actstyle'</span>,<span class="string">'none'</span>,<span class="string">'arrowvalues'</span>,v);
0079 figure(27); netgraph_concentrations(fsc_options.network_CoHid,[],v,1,gp);
0080 
0081 figure(4); clf; 
0082 gp = struct(<span class="string">'arrowsize'</span>,0.05,<span class="string">'actstyle'</span>,<span class="string">'none'</span>,<span class="string">'colorbar'</span>,1,<span class="string">'showsign'</span>,0,<span class="string">'actprintnames'</span>,1,<span class="string">'metprintnames'</span>,0,<span class="string">'flag_edges'</span>,1,<span class="string">'colormap'</span>, value_colors);
0083 gp.actvaluesmin = log10(10);
0084 gp.actvaluesmax = log10(10000);
0085 gp.actstyle     = <span class="string">'fixed'</span>;
0086 gp.arrowstyle   = <span class="string">'none'</span>;
0087 netgraph_concentrations(fsc_options.network_CoHid,[],log10(r.Kcatf),1,gp); 
0088 title(<span class="string">'log10 Kcat+, balanced (1/s)'</span>);
0089 
0090 figure(14); clf; 
0091 gp = struct(<span class="string">'arrowsize'</span>,0.05,<span class="string">'actstyle'</span>,<span class="string">'none'</span>,<span class="string">'colorbar'</span>,1,<span class="string">'showsign'</span>,0,<span class="string">'actprintnames'</span>,1,<span class="string">'metprintnames'</span>,0,<span class="string">'flag_edges'</span>,1,<span class="string">'colormap'</span>, value_colors);
0092 gp.actvaluesmin = log10(10);
0093 gp.actvaluesmax = log10(10000);
0094 gp.actstyle     = <span class="string">'fixed'</span>;
0095 gp.arrowstyle   = <span class="string">'none'</span>;
0096 netgraph_concentrations(fsc_options.network_CoHid,[],log10(kinetic_data.Kcatf.median),1,gp); 
0097 title(<span class="string">'log10 Kcat+, original (1/s)'</span>);
0098 
0099 
0100 figure(11); clf; 
0101 gp.actstyle     = <span class="string">'none'</span>;
0102 gp.metvaluesmin = log10(fsc_options.conc_min_default);
0103 gp.metvaluesmax = log10(100);<span class="comment">% (fsc_options.conc_max_default);</span>
0104 netgraph_concentrations(network,log10(c.initial(:,1)),[],1,gp); title(<span class="string">'Initial state: log10 Concentrations (mM)'</span>);
0105 
0106 figure(12); clf; 
0107 gp.arrowstyle   =<span class="string">'none'</span>; gp.actstyle = <span class="string">'fixed'</span>;
0108 gp.actvaluesmin = log10(1);
0109 gp.actvaluesmax = log10(100);
0110 gp.metvaluesmin = [];
0111 gp.metvaluesmax = [];
0112 netgraph_concentrations(fsc_options.network_CoHid,[],log10(A_forward.initial),1,gp); title(<span class="string">'Inital state: log10 Reaction affinities (kJ/mol)'</span>);
0113 
0114 figure(8); clf
0115 gp = struct(<span class="string">'arrowstyle'</span>,<span class="string">'none'</span>,<span class="string">'colorbar'</span>,1,<span class="string">'showsign'</span>,0,<span class="string">'actprintnames'</span>,0,<span class="string">'flag_edges'</span>,1,<span class="string">'colormap'</span>, value_colors);
0116 gp.metvaluesmin = log10(fsc_options.conc_min_default);
0117 gp.metvaluesmax = log10(100); <span class="comment">% fsc_options.conc_max_default);</span>
0118 netgraph_concentrations(network,log10(c.data(:,1)),[],1,gp); title(<span class="string">'Experimental data (1st file): log10 Concentrations (mM)'</span>);
0119 
0120 figure(28); clf
0121 gp = struct(<span class="string">'arrowstyle'</span>,<span class="string">'none'</span>,<span class="string">'colorbar'</span>,1,<span class="string">'showsign'</span>,0,<span class="string">'actprintnames'</span>,0,<span class="string">'flag_edges'</span>,1,<span class="string">'colormap'</span>, value_colors);
0122 gp.metvaluesmin = log10(fsc_options.conc_min_default);
0123 gp.metvaluesmax = log10(100); <span class="comment">% fsc_options.conc_max_default);</span>
0124 netgraph_concentrations(network,log10(c.fixed),[],1,gp); title(<span class="string">'Fixed values: log10 Concentrations (mM)'</span>);
0125 
0126 figure(9); clf
0127 gp = struct(<span class="string">'arrowstyle'</span>,<span class="string">'none'</span>,<span class="string">'colorbar'</span>,1,<span class="string">'showsign'</span>,0,<span class="string">'actprintnames'</span>,1,<span class="string">'flag_edges'</span>,1,<span class="string">'colormap'</span>, value_colors);
0128 gp.actnames     = gene_names;
0129 gp.actvaluesmin = log10(nanmin(u.data));
0130 gp.actvaluesmax = log10(nanmax(u.data));
0131 gp.metvaluesmin = [];
0132 gp.metvaluesmax = [];
0133 netgraph_concentrations(fsc_options.network_CoHid,[],log10(u.data),1,gp); title(<span class="string">'Experimental data: log10 enzyme levels (mM)'</span>);
0134 
0135 
0136 <span class="comment">% --------------------------------------</span>
0137 <span class="comment">% concentration predictions</span>
0138 
0139 <span class="comment">% everything in one picture</span>
0140 
0141 figure(18); clf; hold on;
0142 set(gcf,<span class="string">'Position'</span>,[100 300 1000 500])
0143 xtick = 0:length(ind_show_met)-1;
0144 h     = [];
0145 my_fsc_scores = [{<span class="string">'initial'</span>},fsc_options.fsc_scores];
0146 <span class="keyword">for</span> it = 1:length(my_fsc_scores),
0147   fsc_score = my_fsc_scores{it};
0148   h(it)     = plot(xtick,c.(fsc_score)(ind_show_met,1) * exp(0.03*it),<span class="string">'-'</span>,<span class="string">'MarkerSize'</span>,20); <span class="comment">%  * exp(0.001*it)</span>
0149 <span class="keyword">end</span>
0150 line_colors(h,<span class="string">'sunrise_colors'</span>);
0151 
0152 plot(xtick,c.fixed(ind_show_met),<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,30);
0153 <span class="keyword">if</span> length(c.data),
0154   n_c_data_sets = size(c.data,2);
0155   plot(repmat(column(xtick),n_c_data_sets,1),reshape(c.data(ind_show_met,:),n_c_data_sets * length(ind_show_met),1),<span class="string">'k.'</span>,<span class="string">'MarkerSize'</span>,20); 
0156   methods = [my_fsc_scores,{<span class="string">'fixed'</span>,<span class="string">'data'</span>}];
0157 <span class="keyword">else</span>
0158   methods = [my_fsc_scores,{<span class="string">'fixed'</span>}];
0159 <span class="keyword">end</span>
0160 
0161 metnames_show = strrep(network.metabolites(ind_show_met),<span class="string">'D-'</span>,<span class="string">''</span>);
0162 text(xtick + 0.2,c.data(ind_show_met),metnames_show,<span class="string">'FontSize'</span>,10);
0163 legend(methods,<span class="string">'Location'</span>,<span class="string">'NorthEastOutside'</span>,<span class="string">'FontSize'</span>,10);
0164 axis tight; set(gca,<span class="string">'XTick'</span>,xtick,<span class="string">'XTickLabel'</span>,metnames_show,<span class="string">'YScale'</span>,<span class="string">'Log'</span>);
0165 my_xticklabel([],fsc_options.conc_min_default,[],10);
0166 title(<span class="string">'Comparison: log10 Concentration profiles (mM)'</span>);
0167 
0168 
0169 
0170 <span class="comment">% --------------------------------------</span>
0171 <span class="comment">% reaction affinity predictions</span>
0172 
0173 figure(19); clf; hold on;
0174 set(gcf,<span class="string">'Position'</span>,[200 400 1000 500])
0175 xtick = 0:length(network.actions);
0176 h = [];
0177 
0178 my_fsc_scores = [{<span class="string">'initial'</span>},fsc_options.fsc_scores];
0179 
0180 <span class="keyword">for</span> it = 1:length(my_fsc_scores),
0181   fsc_score = my_fsc_scores{it};
0182   h(it)     = plot(xtick,[0; -cumsum(v .* A_forward.(fsc_score)(:,1))] + (0.002*it),<span class="string">'-'</span>); <span class="comment">%</span>
0183 <span class="keyword">end</span>
0184 line_colors(h,<span class="string">'sunrise_colors'</span>);
0185 
0186 legend(my_fsc_scores,<span class="string">'Location'</span>,<span class="string">'NorthEast'</span>,<span class="string">'FontSize'</span>,16);
0187 axis tight; set(gca,<span class="string">'XTick'</span>,xtick,<span class="string">'XTickLabel'</span>,[{<span class="string">''</span>};strrep(network.actions,<span class="string">'_'</span>, <span class="string">' '</span>)]);
0188 my_xticklabel([],[],[],10);
0189 title(<span class="string">'Cumulative entropy production (v * A)'</span>);
0190 
0191 
0192 <span class="comment">% --------------------------------------</span>
0193 <span class="comment">% c over KM</span>
0194 
0195 figure(20); subplot(<span class="string">'Position'</span>,[0.15 0.05 0.8 0.7]);
0196 c_over_KM = repmat(c.initial(:,1)',length(network.actions),1)./r.KM;
0197 c_over_KM(r.KM==0) = nan;
0198 im(log10(c_over_KM(:,ind_show_met)),[-3,3],network.actions,network.metabolites(ind_show_met)); colormap([0.95 0.95 0.95; value_colors]); colorbar
0199 my_xticklabel
0200 <span class="comment">%title('log10 c (initial solution) / KM');</span>
0201 
0202 
0203 <span class="comment">% --------------------------------------</span>
0204 <span class="comment">% KM</span>
0205 
0206 <span class="comment">% data</span>
0207 figure(21); subplot(<span class="string">'Position'</span>,[0.15 0.05 0.8 0.7]);
0208 my_KM = kinetic_data.KM.median;
0209 my_KM(my_KM==0) = nan;
0210 im(log10(my_KM(:,ind_show_met)),[-3,2],network.actions,network.metabolites(ind_show_met)); colormap([0.95 0.95 0.95; value_colors]); colorbar
0211 my_xticklabel
0212 
0213 <span class="comment">% balanced</span>
0214 figure(22); subplot(<span class="string">'Position'</span>,[0.15 0.05 0.8 0.7]);
0215 my_KM = r.KM;
0216 my_KM(my_KM==0) = nan;
0217 im(log10(my_KM(:,ind_show_met)),[-3,2],network.actions,network.metabolites(ind_show_met)); colormap([0.95 0.95 0.95; value_colors]); colorbar
0218 my_xticklabel
0219 
0220 
0221 
0222 <span class="comment">% --------------------------------------</span>
0223 <span class="comment">% enzyme level predictions</span>
0224 
0225 <span class="comment">% barplot for all methods</span>
0226 
0227 figure(33); clf; 
0228 
0229 ug      = [];
0230 methods = fsc_options.fsc_scores;
0231 
0232 <span class="keyword">for</span> it = 1:length(fsc_options.fsc_scores),
0233   fsc_score = fsc_options.fsc_scores{it};
0234   ug_meth   = up.(fsc_score)(fsc_options.ind_scored_enzymes,1);
0235   ug_meth   = ug_meth/sum(ug_meth);
0236   ug        = [ug, ug_meth];
0237 <span class="keyword">end</span>
0238 
0239 <span class="keyword">if</span> length(u.data),
0240   ug_data = u.data(fsc_options.ind_scored_enzymes) / nansum(u.data(fsc_options.ind_scored_enzymes));
0241   ug      = [ug, ug_data];
0242   methods = [methods,{<span class="string">'data'</span>}];
0243 <span class="keyword">end</span>
0244 
0245 h = bar(flipud(ug(ind_genes_scored,:))',<span class="string">'stacked'</span>);
0246 colormap(flipud(enzyme_colors)); 
0247 axis([0,3+length(fsc_options.fsc_scores), 0, 1.02]); 
0248 legend(fliplr(h),gene_names(ind_genes_scored),<span class="string">'Fontsize'</span>,8,<span class="string">'Location'</span>,<span class="string">'East'</span>)
0249 set(gca,<span class="string">'FontSize'</span>,12);
0250 set(gca,<span class="string">'XTickLabel'</span>,methods); ylabel(<span class="string">'Relative protein amount'</span>);
0251 
0252 <span class="comment">% color legend</span>
0253 
0254 figure(34); clf; 
0255 mmm = nan * ones(nr,1); 
0256 mmm(fsc_options.ind_scored_enzymes) = ind_genes(fsc_options.ind_scored_enzymes);
0257 gpp = struct(<span class="string">'actprintnames'</span>,1,<span class="string">'arrowstyle'</span>,<span class="string">'none'</span>,<span class="string">'showsign'</span>,0,<span class="string">'colormap'</span>,enzyme_colors,<span class="string">'text_offset'</span>,[0.03,0]);
0258 gpp.actnames = gene_names;
0259 netgraph_concentrations(fsc_options.network_CoHid,[],column(mmm),1,gpp); 
0260 <span class="comment">%title('Enzymes colour legend');</span>
0261 
0262 
0263 
0264 
0265 <span class="comment">% -----------------------------------</span>
0266 <span class="comment">% PLOTS FOR MEASURED DATA ONLY</span>
0267 <span class="comment">% -----------------------------------</span>
0268 
0269 <span class="comment">% ---------------------------------------------</span>
0270 <span class="comment">% plot flux (data) versus enzyme level (data)</span>
0271 
0272 figure(44); clf; hold on
0273 is_finite  = isfinite(u.data .* v);
0274 ind_finite = find(is_finite);
0275 my_colors  = enzyme_colors(ind_genes,:);
0276 <span class="keyword">for</span> it = 1:nr,
0277   <span class="keyword">if</span> is_finite(it),
0278     plot(u.data(it),v(it),<span class="string">'.'</span>,<span class="string">'Color'</span>,my_colors(it,:),<span class="string">'MarkerSize'</span>,30);
0279   <span class="keyword">end</span>
0280 <span class="keyword">end</span>
0281 text(u.data(ind_finite) * 1.03,v(ind_finite),gene_names(ind_finite));
0282 set(gca,<span class="string">'XScale'</span>,<span class="string">'Log'</span>,<span class="string">'YScale'</span>,<span class="string">'Log'</span>,<span class="string">'Fontsize'</span>,14);
0283 xlabel(<span class="string">'Measured enzyme level (mM)'</span>,<span class="string">'Fontsize'</span>,14); ylabel(<span class="string">'Measured flux'</span>,<span class="string">'Fontsize'</span>,14);
0284 axis equal; axis square; axis tight
0285 <span class="keyword">if</span> length(ind_finite),
0286   [cc, pvalue] = corr(log(u.data(ind_finite)),log(v(ind_finite)));
0287   [cc_spear, pvalue_spear] = corr(log(u.data(ind_finite)),log(v(ind_finite)),<span class="string">'type'</span>,<span class="string">'Spearman'</span>);
0288   title(sprintf(<span class="string">'r (Pearson correlation): %2.2f [p-value %2.3f]\n r (Spearman rank corr): %2.2f [p-value %2.3f]'</span>,cc,pvalue,cc_spear,pvalue_spear));
0289 <span class="keyword">end</span>
0290 
0291 
0292 <span class="comment">% --------------------------------------------------------</span>
0293 <span class="comment">% plot flux (data) versus enzyme level * kcat (both data)</span>
0294 
0295 figure(45);clf; hold on
0296 is_finite  = isfinite(u.data .* kinetic_data.Kcatf.median .* v);
0297 ind_finite = find(is_finite);
0298 my_colors  = enzyme_colors(ind_genes,:);
0299 <span class="keyword">for</span> it = 1:nr,
0300    <span class="keyword">if</span> is_finite(it),
0301      plot(u.data(it),v(it)/kinetic_data.Kcatf.median(it),<span class="string">'.'</span>,<span class="string">'Color'</span>,my_colors(it,:),<span class="string">'MarkerSize'</span>,30);
0302    <span class="keyword">end</span>
0303 <span class="keyword">end</span>
0304 text(u.data(ind_finite) * 1.03,v(ind_finite)  ./ kinetic_data.Kcatf.median(ind_finite),gene_names(ind_finite));
0305 set(gca,<span class="string">'XScale'</span>,<span class="string">'Log'</span>,<span class="string">'YScale'</span>,<span class="string">'Log'</span>,<span class="string">'Fontsize'</span>,14);
0306 xlabel(<span class="string">'Measured enzyme level (mM)'</span>,<span class="string">'Fontsize'</span>,14); ylabel(<span class="string">'Measured flux / kcat (data)'</span>,<span class="string">'Fontsize'</span>,14);
0307 axis equal; axis square; axis tight
0308 <span class="keyword">if</span> length(ind_finite),
0309   [cc, pvalue] = corr(log(u.data(ind_finite)),log(v(ind_finite)./kinetic_data.Kcatf.median(ind_finite)));
0310   [cc_spear, pvalue_spear] = corr(log(u.data(ind_finite)),log(v(ind_finite)./kinetic_data.Kcatf.median(ind_finite)),<span class="string">'type'</span>,<span class="string">'Spearman'</span>);
0311   title(sprintf(<span class="string">'r (Pearson correlation): %2.2f [p-value %2.3f]\n r (Spearman rank corr): %2.2f [p-value %2.3f]'</span>,cc,pvalue,cc_spear,pvalue_spear));
0312 <span class="keyword">end</span>
0313 
0314 <span class="comment">% --------------------------------------------------------</span>
0315 <span class="comment">% barplot</span>
0316 
0317 figure(46); clf; 
0318 n_methods = length(fsc_options.fsc_scores);
0319 
0320 <span class="keyword">for</span> it_method = 1:n_methods,
0321   this_fsc_score = fsc_options.fsc_scores{it_method};
0322   ug   = up.(this_fsc_score)(fsc_options.ind_scored_enzymes,1);
0323   subplot(n_methods+1,1,it_method); hold on;set(gca,<span class="string">'FontSize'</span>,10);
0324   <span class="keyword">for</span> it = 1:length(ind_genes_scored);
0325     h = bar(it,ug(ind_genes_scored(it))); set(h,<span class="string">'FaceColor'</span>,enzyme_colors(it,:)); 
0326   <span class="keyword">end</span>
0327   ylabel(sprintf(<span class="string">'%s'</span>,this_fsc_score));
0328   set(gca,<span class="string">'XTick'</span>,[]); 
0329 <span class="keyword">end</span>
0330 
0331 ud   = u.data(fsc_options.ind_scored_enzymes,1);
0332 subplot(n_methods+1,1,it_method+1); hold on
0333 <span class="keyword">for</span> it = 1:length(ind_genes_scored);
0334   h= bar(it,ud(ind_genes_scored(it))); set(h,<span class="string">'FaceColor'</span>,enzyme_colors(it,:)); 
0335 <span class="keyword">end</span>
0336 ylabel(<span class="string">'Data'</span>);
0337 set(gca,<span class="string">'FontSize'</span>,6);
0338 set(gca,<span class="string">'XTick'</span>,1:length(ind_genes_scored),<span class="string">'XTickLabel'</span>,gene_names(ind_genes_scored)); 
0339 
0340 
0341 <span class="comment">% --------------------------------------------------------</span>
0342 <span class="comment">% SAVE GRAPHICS</span>
0343 <span class="comment">% --------------------------------------------------------</span>
0344 
0345 
0346 <span class="keyword">if</span> fsc_options.print_graphics,
0347   cd(fsc_options.psfile_dir);
0348   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_fluxes.eps'</span>],<span class="string">'-f27'</span>,<span class="string">'-depsc'</span>);
0349   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_data_concentrations.eps'</span>],<span class="string">'-f8'</span>,<span class="string">'-depsc'</span>);
0350   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_data_enzymes.eps'</span>],<span class="string">'-f9'</span>,<span class="string">'-depsc'</span>);
0351   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_fix_concentrations.eps'</span>],<span class="string">'-f28'</span>,<span class="string">'-depsc'</span>);
0352   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_init_concentrations.eps'</span>],<span class="string">'-f11'</span>,<span class="string">'-depsc'</span>);
0353   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_init_affinities.eps'</span>],<span class="string">'-f12'</span>,<span class="string">'-depsc'</span>);
0354   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_kcat_balanced.eps'</span>],<span class="string">'-f4'</span>,<span class="string">'-depsc'</span>);
0355   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_kcat_original.eps'</span>],<span class="string">'-f14'</span>,<span class="string">'-depsc'</span>);
0356   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_barplot.eps'</span>],<span class="string">'-f33'</span>,<span class="string">'-depsc'</span>);
0357   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_barplot_legend.eps'</span>],<span class="string">'-f34'</span>,<span class="string">'-depsc'</span>);
0358   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_all_conc_profiles.eps'</span>],<span class="string">'-f18'</span>,<span class="string">'-depsc'</span>);
0359   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_affinity_profiles.eps'</span>],<span class="string">'-f19'</span>,<span class="string">'-depsc'</span>);
0360   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_c_by_KM_initial.eps'</span>],<span class="string">'-f20'</span>,<span class="string">'-depsc'</span>);
0361   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_KM_original.eps'</span>],<span class="string">'-f21'</span>,<span class="string">'-depsc'</span>);
0362   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_KM_balanced.eps'</span>],<span class="string">'-f22'</span>,<span class="string">'-depsc'</span>);
0363   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_scatter_enzyme_vs_flux.eps'</span>],<span class="string">'-f44'</span>,<span class="string">'-depsc'</span>);
0364   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_scatter_enzyme_kcat_vs_flux.eps'</span>],<span class="string">'-f45'</span>,<span class="string">'-depsc'</span>);
0365   print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_enzyme_multiple_barplots.eps'</span>],<span class="string">'-f46'</span>,<span class="string">'-depsc'</span>);
0366 <span class="keyword">end</span>
0367 
0368 
0369 <span class="comment">% -----------------------------------</span>
0370 <span class="comment">% PLOTS FOR INDIVIDUAL SCORES</span>
0371 <span class="comment">% -----------------------------------</span>
0372 
0373 
0374 <span class="keyword">for</span> it_method = 1:length(fsc_options.fsc_scores),
0375   this_fsc_score = fsc_options.fsc_scores{it_method};
0376   
0377   my_c = c.(this_fsc_score)(:,1);
0378   my_A_forward = A_forward.(this_fsc_score)(:,1);
0379   my_up = up.(this_fsc_score)(:,1);
0380 
0381   figure(1); clf; 
0382   gp.actstyle = <span class="string">'none'</span>;
0383   gp.metvaluesmin = log10(fsc_options.conc_min_default);
0384   gp.metvaluesmax = log10(100);<span class="comment">%fsc_options.conc_max_default);</span>
0385   netgraph_concentrations(network,log10(my_c),[],1,gp); title(<span class="string">'Optimised state: log10 Concentrations (mM)'</span>);
0386   
0387   figure(2); clf; 
0388   gp.arrowstyle=<span class="string">'none'</span>; 
0389   gp.actstyle = <span class="string">'fixed'</span>;
0390   gp.actvaluesmin = log10(0.01);
0391   gp.actvaluesmax = log10(100);
0392   gp.metvaluesmin = [];
0393   gp.metvaluesmax = [];
0394   netgraph_concentrations(fsc_options.network_CoHid,[],log10(my_A_forward),1,gp); title(<span class="string">'Optimised state: log10 Reaction affinities (kJ/mol)'</span>);
0395   
0396   figure(3); clf; 
0397   gp.actnames  = gene_names;
0398   gp.actvaluesmin = log10(10^-6);
0399   gp.actvaluesmax = log10(10^-2);
0400   gp.metvaluesmin = [];
0401   gp.metvaluesmax = [];
0402   netgraph_concentrations(fsc_options.network_CoHid,[],log10(my_up),1,gp); title(<span class="string">'Optimised state: log10 Enzyme levels (mM)'</span>);
0403 
0404   <span class="comment">% --------------------------------------------------------</span>
0405 
0406   figure(101); clf; hold on;
0407   set(gcf,<span class="string">'Position'</span>,[100 300 1000 500])
0408   xtick      = 0:length(ind_show_met)-1;
0409   this_c     = c.(this_fsc_score)(ind_show_met,1);
0410   <span class="keyword">if</span> length(c_min),
0411     this_c_min = c_min.(this_fsc_score)(ind_show_met);
0412     this_c_max = c_max.(this_fsc_score)(ind_show_met);
0413   <span class="keyword">else</span>
0414     this_c_min = 0;
0415     this_c_max = 0;
0416   <span class="keyword">end</span>
0417   ind_fixed  = find(label_names(network.metabolites(ind_show_met), fsc_options.met_fix));
0418 
0419   h = errorbar(xtick,this_c,this_c-this_c_min,this_c_max-this_c,<span class="string">'o'</span>,<span class="string">'LineWidth'</span>,2);
0420   h = plot(xtick(ind_fixed),this_c(ind_fixed),<span class="string">'r.'</span>,<span class="string">'MarkerSize'</span>,30);
0421   <span class="keyword">if</span> length(c.data),
0422     n_c_data_sets = size(c.data,2);
0423     plot(repmat(column(xtick),n_c_data_sets,1),reshape(c.data(ind_show_met,:),n_c_data_sets * length(ind_show_met),1),<span class="string">'k.'</span>,<span class="string">'MarkerSize'</span>,20); 
0424     methods = {this_fsc_score,<span class="string">'fixed'</span>,<span class="string">'data'</span>};
0425   <span class="keyword">else</span>
0426     methods = {this_fsc_score,<span class="string">'fixed'</span>};
0427   <span class="keyword">end</span>
0428   metnames_show = strrep(network.metabolites(ind_show_met),<span class="string">'D-'</span>,<span class="string">''</span>);
0429   text(xtick + 0.2,c.(this_fsc_score)(ind_show_met),metnames_show,<span class="string">'FontSize'</span>,10);
0430   legend(methods,<span class="string">'Location'</span>,<span class="string">'NorthEastOutside'</span>,<span class="string">'FontSize'</span>,10);
0431   ylabel(<span class="string">'Concentration [mM]'</span>);
0432   axis tight; set(gca,<span class="string">'YScale'</span>,<span class="string">'Log'</span>,<span class="string">'XTick'</span>,[]); 
0433   <span class="comment">% a = axis; hold on</span>
0434   <span class="comment">% for itttt = 1:length(xtick),</span>
0435   <span class="comment">%   plot([xtick(itttt),xtick(itttt)],[a(3),a(4)],'-');</span>
0436   <span class="comment">% end</span>
0437   
0438   
0439   <span class="comment">% --------------------------------------</span>
0440   <span class="comment">% enzyme predictions scatter plot</span>
0441   
0442   figure(102); clf; hold on; set(gcf,<span class="string">'Position'</span>,[150 350 600 600])
0443   is_finite  = isfinite(u.data) .* [v~=0];
0444   ind_finite = find(is_finite);
0445   my_colors  = enzyme_colors(ind_genes,:);
0446   <span class="comment">% plot points, then axis tight, then lines</span>
0447   <span class="keyword">for</span> it = 1:nr,
0448     <span class="keyword">if</span> is_finite(it),
0449       plot(u.data(it),u.(this_fsc_score)(it,1),<span class="string">'.'</span>,<span class="string">'Markersize'</span>,30,<span class="string">'Color'</span>,my_colors(it,:)); 
0450     <span class="keyword">end</span>
0451   <span class="keyword">end</span>
0452   axis tight; axis equal; axis square; 
0453   <span class="keyword">for</span> it = 1:nr,
0454     <span class="keyword">if</span> is_finite(it) * [1-isempty(u_min)],
0455       <span class="keyword">if</span> isfield(u_min,this_fsc_score)
0456         plot(u.data(it) * [1 1],[u_min.(this_fsc_score)(it),u_max.(this_fsc_score)(it)],<span class="string">'-'</span>,<span class="string">'Color'</span>,my_colors(it,:)); 
0457       <span class="keyword">end</span>
0458     <span class="keyword">end</span>
0459   <span class="keyword">end</span>
0460   text(1.05*u.data(ind_finite),1.05*u.(this_fsc_score)(ind_finite,1),network.genes(fsc_options.ind_scored_enzymes(ind_finite)),<span class="string">'FontSize'</span>,8);
0461   xlabel(<span class="string">'Measured enzyme level (mM)'</span>,<span class="string">'Fontsize'</span>,14);
0462   ylabel(sprintf(<span class="string">'Predicted enzyme level (mM) %s'</span>,this_fsc_score),<span class="string">'Fontsize'</span>,14);
0463   set(gca,<span class="string">'XScale'</span>,<span class="string">'Log'</span>,<span class="string">'YScale'</span>,<span class="string">'Log'</span>,<span class="string">'Fontsize'</span>,14);
0464 <span class="keyword">if</span> length(ind_finite),
0465   [cc, pvalue] = corr(log(u.data(ind_finite)),log(u.(this_fsc_score)(ind_finite,1)));
0466   [cc_spear, pvalue_spear] = corr(log(u.data(ind_finite)),log(u.(this_fsc_score)(ind_finite,1)),<span class="string">'type'</span>,<span class="string">'Spearman'</span>);
0467   title(sprintf(<span class="string">'r (Pearson correlation): %2.2f [p-value %2.3f]\n r (Spearman rank corr): %2.2f [p-value %2.3f]'</span>,cc,pvalue,cc_spear,pvalue_spear));
0468 <span class="keyword">end</span>  
0469   
0470   <span class="comment">% --------------------------------------</span>
0471   <span class="comment">% concentration predictions scatter plot</span>
0472   
0473   figure(103); clf; hold on; set(gcf,<span class="string">'Position'</span>,[150 350 600 600])
0474   
0475   my_c_min = min(nanmin(c.data(:)),nanmin(c.(this_fsc_score)(:)));
0476   my_c_max = max(nanmax(c.data(:)),nanmax(c.(this_fsc_score)(:)));
0477   
0478   plot([my_c_min,my_c_max],[my_c_min,my_c_max],<span class="string">'-'</span>);
0479   ind_non_fixed = find(label_names(network.metabolites, fsc_options.met_fix)==0);
0480   
0481   <span class="keyword">for</span> itt = 1:length(ind_non_fixed),
0482     it = ind_non_fixed(itt);
0483     plot([nanmin(c.data(it,:)),nanmax(c.data(it,:))],c.(this_fsc_score)(it,1) * [1 1],<span class="string">'-'</span>,<span class="string">'Color'</span>,[.7 .7 .7]);
0484     <span class="keyword">if</span> [1-isempty(c_min)],
0485       <span class="keyword">if</span> isfield(c_min,this_fsc_score),
0486       plot(nanmean(c.data(it,:))* [1 1],[c_min.(this_fsc_score)(it),c_max.(this_fsc_score)(it)],<span class="string">'k'</span>,<span class="string">'Color'</span>,[.5 0 0]);
0487       <span class="keyword">end</span>
0488     <span class="keyword">end</span>
0489     plot(nanmean(c.data(it,:)),c.(this_fsc_score)(it,1),<span class="string">'r.'</span>,<span class="string">'Markersize'</span>,20);
0490     text(1.1*nanmean(c.data(it,:)),1.1*c.(this_fsc_score)(it,1),network.metabolites{it},<span class="string">'FontSize'</span>,6);  
0491   <span class="keyword">end</span>
0492   
0493   axis tight; axis equal; axis square; 
0494   xlabel(<span class="string">'Median experimental concentration (mM)'</span>,<span class="string">'Fontsize'</span>,14);
0495   ylabel(sprintf(<span class="string">'Predicted concentration (mM) %s'</span>,this_fsc_score),<span class="string">'Fontsize'</span>,14);
0496   set(gca,<span class="string">'XScale'</span>,<span class="string">'Log'</span>,<span class="string">'YScale'</span>,<span class="string">'Log'</span>,<span class="string">'Fontsize'</span>,14);
0497   
0498   my_nanmean_c_data   = nanmean(c.data,2);
0499   ind_finite          = find(isfinite(my_nanmean_c_data));
0500 <span class="keyword">if</span> length(ind_finite),
0501   [cc, pvalue] = corr(log(my_nanmean_c_data(ind_finite)),log(c.(this_fsc_score)(ind_finite,1)));
0502   [cc_spear, pvalue_spear] = corr(log(my_nanmean_c_data(ind_finite)),log(c.(this_fsc_score)(ind_finite,1)),<span class="string">'type'</span>,<span class="string">'Spearman'</span>);
0503   title(sprintf(<span class="string">'r (Pearson correlation): %2.2f [p-value %2.3f]\n r (Spearman rank corr): %2.2f [p-value %2.3f]'</span>,cc,pvalue,cc_spear,pvalue_spear));
0504 <span class="keyword">end</span>
0505 
0506   <span class="comment">% --------------------------------------------------------</span>
0507   <span class="comment">% barplot</span>
0508   
0509   ug   = up.(this_fsc_score)(fsc_options.ind_scored_enzymes,1);
0510   ud   = u.data(fsc_options.ind_scored_enzymes,1);
0511   
0512   figure(104); clf; 
0513   subplot(2,1,1);
0514   <span class="keyword">for</span> it = 1:length(ind_genes_scored);
0515     h = bar(it,ug(ind_genes_scored(it))); set(h,<span class="string">'FaceColor'</span>,enzyme_colors(it,:)); hold on
0516   <span class="keyword">end</span>
0517   ylabel(sprintf(<span class="string">'Predicted enzyme level [mM] %s'</span>,this_fsc_score));
0518   title(sprintf(<span class="string">'Total predicted enzyme level (%s): %f mM'</span>,this_fsc_score, sum(ug(ind_genes_scored))));
0519 
0520   subplot(2,1,2);
0521   <span class="keyword">for</span> it = 1:length(ind_genes_scored);
0522     h= bar(it,ud(ind_genes_scored(it))); set(h,<span class="string">'FaceColor'</span>,enzyme_colors(it,:)); hold on
0523   <span class="keyword">end</span>
0524   set(gca,<span class="string">'FontSize'</span>,8);
0525   set(gca,<span class="string">'XTick'</span>,1:length(ind_genes_scored),<span class="string">'XTickLabel'</span>,gene_names(ind_genes_scored)); 
0526   ylabel(<span class="string">'Measured enzyme level [mM]'</span>);
0527   set(gca,<span class="string">'FontSize'</span>,8);
0528 
0529   <span class="comment">% --------------------------------------</span>
0530 <span class="comment">% c over KM</span>
0531 
0532 figure(105); subplot(<span class="string">'Position'</span>,[0.15 0.05 0.8 0.7]);
0533 c_over_KM = repmat(c.(this_fsc_score)(:,1)',length(network.actions),1)./r.KM;
0534 c_over_KM(r.KM==0) = nan;
0535 im(log10(c_over_KM(:,ind_show_met)),[-3,3],network.actions,network.metabolites(ind_show_met)); colormap([0.95 0.95 0.95; value_colors]); colorbar
0536 my_xticklabel
0537 <span class="comment">%title('log10 c (initial solution) / KM');</span>
0538 
0539   
0540   <span class="comment">% --------------------------------------------------------</span>
0541 
0542   <span class="keyword">if</span> fsc_options.print_graphics,
0543     cd(fsc_options.psfile_dir);
0544     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_opt_concentrations.eps'</span>],<span class="string">'-f1'</span>,<span class="string">'-depsc'</span>);
0545     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_opt_affinities.eps'</span>],    <span class="string">'-f2'</span>,<span class="string">'-depsc'</span>);
0546     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_opt_enzymes.eps'</span>],       <span class="string">'-f3'</span>,<span class="string">'-depsc'</span>);
0547     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_conc_prediction.eps'</span>],  <span class="string">'-f101'</span>,<span class="string">'-depsc'</span>);
0548     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_enzyme_scatter.eps'</span>], <span class="string">'-f102'</span>,<span class="string">'-depsc'</span>);
0549     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_conc_scatter.eps'</span>], <span class="string">'-f103'</span>,<span class="string">'-depsc'</span>);
0550     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_enzyme_prediction.eps'</span>],<span class="string">'-f104'</span>,<span class="string">'-depsc'</span>);
0551     print([ model_name <span class="string">'_'</span> fsc_options.run_id <span class="string">'_'</span> this_fsc_score <span class="string">'_c_by_KM.eps'</span>],<span class="string">'-f105'</span>,<span class="string">'-depsc'</span>);
0552   <span class="keyword">end</span>
0553   
0554 <span class="keyword">end</span>
0555 
0556 <span class="keyword">if</span> fsc_options.print_graphics,
0557   display(sprintf(<span class="string">'Graphics files written to directory %s'</span>,fsc_options.psfile_dir));
0558 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 07-Nov-2014 11:29:38 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>